---
title: 异常值检测
categories:
  - 计算机
  - 机器学习
mathjax: true
abbrlink: 63931
date: 2023-03-26 18:14:45
---

## 背景

### 应用场景

1. 金融
   1. 账户安全性
   2. 客户真实性
   3. 欺诈检测（保险，审计，刷单，骗购，刷评论）
2. 计算机安全检测，网络流量异常检测
3. 调查可靠性，查询安全性
4. 硬件检测（数据中心，云服务）
5. 药品检测

<!--more-->

### 难点

- 确定正常状态的范围非常困难。通常，正常和异常的边界很模糊，边界附近的点容易误判。
- 异常可能被伪装。
- 缺乏标记数据。
- 数据通常含有噪音。

## 不同类型

### 点异常（Point Anomalies）

大多数情况。与其他数据相比，单个数据的异常。

> 一大笔交易在一些小额交易中是异常。

### 上下文异常（Contextual Anomalies）

数据在特定上下文中是异常的，在不同的上下文中可能不是异常。

> 26°C 在冬天是异常，但在夏天是正常。
>
> 一大笔消费在工作时间是异常，但在促销季是正常。

### 集合异常（Collective Anomalies）

不常见，难以检测（可能从未发生过）。数据的集合在整个数据集中异常，但单个值不是异常。

> 大量地购买 iPhone 是异常，但购买一部不是。
>
> 同时购买高压锅、背包和钉子是异常。

## 欺诈种类

### ATO（Account Hacker）

#### Device Malwares

- mobile interception
- reroute traffic
- malicious material in network security system

#### Phishing Websites

需要输入个人信息：信用卡、银行账号、登录信息等

### Identity Theft

拿到身份后去申请贷款、信用卡、银行透支

### Social Engineering

针对大众，或针对特定群体、组织

## 欺诈模型 feature

- 交易信息
  - 国家、地区、邮编、地址、姓名、邮箱、IP
  - 安全认证：手机、邮箱
  - 金额
  - 产品类型
  - 时间
- 设备信息
  - 操作系统、浏览器、app、IP、VPN
- 链接信息
  - 同一台设备上的账号数
- 风险评估
  - 邮箱域名、地址
- 时间聚合
- 其他
  - 性别、年龄、签发银行
  - 卡类型

## 模型

### 固定阈值模型

超过阈值认为异常。怎么定阈值？

- 预先学习过的数据（top k，分位数）
- SLA（Service Level Agreement），用户要求

优势：简单、广泛、恒定

缺陷：不适用于周期、趋势、季节性数据

### 移动阈值模型

阈值是输入的函数。比如，当前阈值是前 60 个值的中位数的 $k$ 倍。

### 时间序列模型

AR，MA，ARIMA

### 百分位模型

比如，一个顾客的消费异常，如果它超过了相似顾客消费中位数的 $k\%$。

### 统计模型

#### 一维

在正态分布假设下，$3\sigma$ 包含了 $99.7\%$ 的数据。

箱线图分析：最小 $Q_1-k(Q_3-Q_1)$，最大 $Q_3+k(Q_3-Q_1)$ 。

#### 高维

在每维特征独立同高斯分布的假设下，
$$
p(x)=\prod_{j=1}^n{1\over\sqrt{2\pi}\sigma_j}\exp\left(-\frac{(x_j-\mu_j)^2}{2\sigma_j^2}\right).
$$
报异常如果 $p(x)<\varepsilon$ 。

### 无监督模型

#### K-means

#### Isolation Forest

binary tree 的集合，随机分裂。异常值更容易被分到叶子结点上，正常值更深。

#### LOF（Local Outlier Factor）

对每个数据点，计算到其他点的距离，找到 kNN，计算分数。思想是计算相对密度，如果一个点的相对密度很低，认为是异常值。

不适用于大数据集（计算距离、排序很耗时），参数选择困难。

## 一个例子

假设有 10000 个正常硬盘、20 个损坏硬盘的数据。我们把数据分成三组：

train：6000 个正常硬盘

test：2000个正常硬盘，10 个损坏硬盘

validation：2000 个正常硬盘，10 个损坏硬盘

1. 用 train 构建 $p(x)$。
2. 在 validation 上尝试不同的 $\varepsilon$，根据 $F_1$ 或查准率等来选择阈值。
3. 在 test 上做预测，计算 $F_1$，precision，recall 等。

<iframe src="/file/OutlierDetection.html" width="100%" height="7000"></iframe>